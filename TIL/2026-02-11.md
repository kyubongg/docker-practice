# 🐳 [TIL] 신입 백엔드 개발자의 첫 Docker & Docker Compose 실습기

**날짜:** 2026년 2월 11일  
**주제:** Spring Boot(JDK 21)와 MySQL을 Docker로 띄우고 연동하기  
**동기:** 인프라 팀원분이 도커로 서버를 여러 개 띄우는 걸 보고 나도 내 프로젝트에 적용해보고 싶어졌다. 이론보단 일단 부딪혀보는 게 빠를 것 같아서 바로 실습 돌입!

---

## 💡 1. 오늘 깨달은 Docker 핵심 개념

* **컨테이너(Container):** 호스트 컴퓨터 안에 통째로 가상 OS를 까는 무거운 방식이 아니라, 내 애플리케이션이 실행될 '격리된 환경'만 가볍게 띄우는 것. 미니 컴퓨터라고 생각하면 편하다.
* **이미지(Image):** 컨테이너를 실행하는 데 필요한 모든 것(JDK, 설정 파일, 내 빌드 파일 등)을 담고 있는 설계도(붕어빵 틀).
* **포트 포워딩 (Port Forwarding):** 오늘 제일 헷갈렸던 부분! `-p 8080:8080`에서 **`[내 컴퓨터 포트] : [도커 내부 포트]`** 순서다. 내 컴퓨터 포트는 마음대로 바꿔도 되지만, 도커 내부 포트는 앱 설정에 맞춰야 한다.
* **볼륨(Volume):** 컨테이너는 일회용이라 꺼지면 데이터가 다 날아간다. DB 데이터를 지키기 위해 내 컴퓨터의 특정 폴더와 도커 내부 폴더를 연결(마운트)하는 기술이다.
* **Docker Compose 네트워크:** 도커 안에서는 `localhost` 대신 `docker-compose.yml`에 적어둔 서비스 이름(예: `db`)으로 통신해야 한다!
* **도커 레이어 캐싱(Layer Caching):** 도커는 코드가 위에서부터 한 줄씩 실행되며, 위쪽이 안 바뀌면 아래쪽도 재사용(Cache)한다. 이를 이용해 라이브러리 다운로드와 소스코드 복사를 분리하면 빌드 속도를 미친 듯이 단축할 수 있다!


---

## 🛠️ 2. 내가 완성한 실무형 멀티 스테이지 Dockerfile
> **도입 이유:** 내 컴퓨터에 자바가 없어도 도커 스스로 코드를 빌드하고, 최종 배포 이미지에는 무거운 빌드 도구와 소스 코드를 빼서 용량과 보안을 최적화하기 위해 도입함!

```dockerfile
# [Stage 1] 요리사: 코드를 빌드할 무거운 JDK 환경
FROM eclipse-temurin:21-jdk-alpine AS builder
WORKDIR /app

# 1. 도커 캐시를 극대화하기 위해 라이브러리 관련 파일만 먼저 복사
COPY gradlew .
COPY gradle gradle
COPY build.gradle settings.gradle ./
RUN chmod +x ./gradlew

# 2. [핵심] 소스 코드 복사 전에 라이브러리만 먼저 다운로드! 
RUN ./gradlew dependencies --no-daemon

# 3. 그 다음 내 진짜 소스 코드를 복사하고 빌드
COPY src ./src
RUN ./gradlew clean build -x test --no-daemon

# [Stage 2] 배달원: 완성된 앱을 실행할 가벼운 JRE 환경
FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

# 4. Stage 1에서 완성된 .jar 파일만 쏙 가져오기 (소스코드 유출 방지, 용량 최적화)
COPY --from=builder /app/build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

---
## 🔥 3. 오늘의 에러와 트러블 슈팅
1. `requires 1 argument` 에러
 - 원인: `docker build -t my-spring-app` 까지만 치고 경로 지정을 안 함
 - 해결: 맨 뒤에 현재 폴더를 의미하는 . 을 찍어줌


## 4. 명령어 정리
- `./gradlew clean build -x test` : (기본) 스프링 코드를 jar로 빌드.

- `docker-compose up -d --build` : (제일 많이 쓸 예정) 코드 바뀌었을 때 이미지 새로 빌드해서 DB랑 같이 백그라운드로 띄우기.

- `docker ps` : 현재 돌아가는 컨테이너 상태(이름, 포트 등) 확인.

- `docker logs -f my-spring-app` : 내 스프링 서버 로그 실시간으로 보기.

- `docker-compose down` : 퇴근할 때 띄워둔 거 싹 다 깔끔하게 끄고 지우기.
